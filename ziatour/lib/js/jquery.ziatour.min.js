!function($){$.fn.ziatour=function(opt){defaults={debug:!1},opt=$.extend(defaults,opt);function next(i){stopVideo($nodes.eq(i)),goto(i+1)}function prev(i){goto(i-1)}function gotoHash(){var $node;$nodes.each(function(){if(location.hash==="#"+$(this).attr("id"))return $node=$(this),$this.data("curNode")==$node.index()||($this.data("curNode",$node.index()),goto($this.data("curNode"))),!1})}function initVideos(params){params=params||{};var hasVideos=$nodes.find(".video").length;function onPlayerReady(e){e.target.setVolume(50)}function onPlayerStateChange(e){var i=$this.data("curNode");$node=$nodes.eq(i),1==e.data?$body.addClass("video-playing"):$body.removeClass("video-playing"),0==e.data&&setTimeout(function(){next(i)},5e3)}setYouTubePrivacyEnhancedMode=function(url){return url.replace(/(^https?\:\/\/)([^\/*])+(\/*)/i,"$1www.youtube-nocookie.com$3")},parseYouTubeVideoId=function(match){match=match.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/);return!(!match||11!=match[7].length)&&match[7]},urlAddParams=function(url,params){var qsStart=0<url.indexOf("?")?"&":"?";for(p in params)url+=qsStart+p+"="+params[p],qsStart="&";return url},loadYouTubeApi=function(url,params){var tag=document.createElement("script");tag.src="//www.youtube.com/iframe_api",tag.type="text/javascript",tag.id="yt-script",document.getElementsByTagName("head")[0].appendChild(tag)},window.onYouTubePlayerAPIReady=function(){$nodes.each(function(playerId){var src,ytplayer,$node=$nodes.eq(playerId);$video=$node.find(".video"),$video.length&&(src=$video.data("youtube-url"),ytplayer=parseYouTubeVideoId(src),playerId="yt-"+$node.attr("id"),$video.attr("id",playerId),src=setYouTubePrivacyEnhancedMode(src),src=urlAddParams(src,params),ytplayer=new YT.Player(playerId,{videoId:ytplayer,wmode:"opaque",playerVars:params,events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}}),$node.data("player",ytplayer))})},hasVideos&&loadYouTubeApi()}function startTour(){var $screen,$img,arr,arrImg=(arr=[],$nodes.each(function(){$screen=$(this),($screen=$screen.find(".screen")).length&&$screen.find("img").each(function(i){($img=$(this)).attr("src")&&arr.push($img.attr("src"))})}),arr);arrImg.length?function(urls,fn){if(urls&&urls.length)for(var img,src,loaded=0,i=0,j=urls.length;i<j;i++)img=new Image,src=urls[i],img.onload=function(){++loaded==urls.length&&fn&&fn()},img.onerror=fn,img.onabort=fn,img.src=src}(arrImg,function(){goto(0)}):goto(0)}var $body,$nodes,$navBtns,$this=$(this),goto=function(i){var $node,timer;0<=i&&i<$nodes.length&&(i>=$this.data("gatedStartNode")&&0==$this.data("isLoggedIn")||(timer=isNaN(i)?1:i,$this.data("curNode",timer),$node=$nodes.eq(i),document.location.hash=$node.attr("id"),$node.hasClass("dark-color-scheme")?$this.addClass("dark-color-scheme"):$this.removeClass("dark-color-scheme"),$node.hasClass("hide-logo")?$this.find(".logo").addClass("hide"):$this.find(".logo").removeClass("hide"),$node.hasClass("hide-exit-btn")?$this.find(".btn-exit:not(.target)").addClass("hide"):$this.find(".btn-exit:not(.target)").removeClass("hide"),clearTimeout($this.data("nodeTimer")),(timer=$node.data("delay-next"))&&!isNaN(timer)&&0<=timer&&(timer=setTimeout(function(){goto(i+1)},1e3*timer),$this.data("nodeTimer",timer)),opt.debug&&($navBtns.removeClass("active"),$navBtns.eq(i).addClass("active")),$nodes.removeClass("show"),$node.addClass("show")))},stopVideo=function($node){ytplayer=$node.data("player"),ytplayer&&ytplayer.stopVideo()};!function(){var $node;$body=$("body"),$this.data("curNode",0),$this.data("isMobile","none"==$this.find("#desktop").css("display")),$this.data("nodeTimer",0),$this.data("gatedStartNode",0),$this.find("#desktop").addClass("nodes"),$this.find("#mobile").addClass("nodes"),($nodes=$this.data("isMobile")?$this.find("#mobile > div"):$this.find("#desktop > div")).each(function(i){($node=$nodes.eq(i)).addClass("node"),$node.find(".tooltip").wrapInner('<div class="shape"><div class="text"/></div>'),$node.find(".target").on("click",function(){($node=$(this).parents(".node")).removeClass("focus");var idx=$node.index();next(idx)}),$node.find(".target").hover(function(){($node=$(this).parents(".node")).addClass("hover")},function(){($node=$(this).parents(".node")).removeClass("hover")}),$node.find(".target").on("mousedown",function(){($node=$(this).parents(".node")).find("img.focus").length&&($node.removeClass("hover"),$node.addClass("focus"))}),$node.find(".btn-back").on("click",function(){var idx=$(this).data("goto");idx&&"undefined"!=idx&&$nodes.siblings("#"+idx).length&&(idx=$nodes.siblings("#"+idx).index(),i=0<idx?idx+1:i),prev(i)})}),function(){$this.data("isLoggedIn",!0);var $loginContainer=$(".login-container"),$primaryLoginContainer=$loginContainer.eq(0),$form=$primaryLoginContainer.find("form");$form.length&&MktoForms2.loadForm("//info.zscaler.com","306-ZEJ-256",4776,function(form){var $mobileLoginContainer;$form.find(".mktoButton[type=submit]").html("continue"),$this.data("isMobile")?($mobileLoginContainer=$loginContainer.eq(1)).length&&($this.data("gatedStartNode",$mobileLoginContainer.parents(".node").index()+1),$mobileLoginContainer.append($form)):$this.data("gatedStartNode",$primaryLoginContainer.parents(".node").index()+1),$this.data("isLoggedIn",!1),form.onSuccess(function(values,followUpUrl){return $this.data("isLoggedIn",!0),goto($this.data("gatedStartNode")),!1}),opt.debug&&$form.on("submit",function(e){return e.preventDefault(),$this.data("isLoggedIn",!0),goto($this.data("gatedStartNode")),!1})})}(),window.onhashchange=gotoHash,initVideos({enablejsapi:1,wmode:"opaque"}),opt.debug&&function(){$this.addClass("debug"),$this.append('<div id="navbar"/>');var $navbar=$this.find("#navbar");$nodes.each(function(i){$navbar.append("<div/>")}),($navBtns=$navbar.find("> div")).on("click",function(){goto($(this).index())}),$(document).on("keydown",function(e){switch(e.which){case 37:return prev($this.data("curNode")),!1;case 39:return next($this.data("curNode")),!1}})}(),$body.addClass("zia-loaded"),startTour()}()}}(jQuery);